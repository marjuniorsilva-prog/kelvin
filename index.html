<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K.S SERVIÇO | Sistema de Gestão Total</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Inter:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --bg-dark: #0f172a;
            --bg-panel: #1e293b;
            --accent: #d4af37; /* Dourado */
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --success: #10b981;
            --danger: #ef4444;
            --info: #3b82f6;
            --glass: rgba(30, 41, 59, 0.7);
        }

        * { box-sizing: border-box; outline: none; }
        
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- LOGIN --- */
        #login-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 9999;
            display: flex; justify-content: center; align-items: center;
        }
        .login-box {
            background: var(--bg-panel); padding: 40px; border-radius: 20px;
            border: 1px solid var(--accent); text-align: center; width: 350px;
        }

        /* --- LAYOUT --- */
        #app-container { display: none; width: 100%; height: 100%; }
        
        aside {
            width: 260px; background: var(--bg-panel);
            border-right: 1px solid rgba(255,255,255,0.05);
            display: flex; flex-direction: column;
        }
        
        .logo-area { padding: 30px; font-family: 'Poppins'; font-size: 1.4rem; color: var(--accent); font-weight: bold; }
        
        nav button {
            background: none; border: none; width: 100%; padding: 15px 30px;
            color: var(--text-muted); text-align: left; cursor: pointer;
            font-size: 1rem; transition: 0.3s; display: flex; align-items: center; gap: 10px;
        }
        nav button:hover, nav button.active { background: rgba(212, 175, 55, 0.1); color: var(--accent); border-right: 3px solid var(--accent); }

        main { flex: 1; padding: 30px; overflow-y: auto; position: relative; }

        /* --- COMPONENTES --- */
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card {
            background: var(--glass); border: 1px solid rgba(255,255,255,0.05);
            padding: 20px; border-radius: 15px;
        }
        .kpi-value { font-size: 1.8rem; font-weight: bold; margin-top: 10px; }
        
        .panel { background: var(--bg-panel); padding: 25px; border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.05); }
        h2 { margin-top: 0; color: var(--accent); font-family: 'Poppins'; font-size: 1.2rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }

        /* FORMULARIOS */
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 15px; }
        
        label { display: block; font-size: 0.8rem; color: var(--text-muted); margin-bottom: 5px; }
        input, select {
            width: 100%; padding: 12px; background: #0f172a; border: 1px solid #334155;
            color: white; border-radius: 8px;
        }
        input:focus { border-color: var(--accent); }

        .btn { padding: 12px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; width: 100%; }
        .btn-gold { background: var(--accent); color: #0f172a; }
        .btn-gold:hover { background: #b5952f; }
        .btn-red { background: var(--danger); color: white; }
        .btn-green { background: var(--success); color: white; }

        /* TABELA */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.9rem; }
        th { text-align: left; padding: 12px; color: var(--text-muted); border-bottom: 1px solid #334155; }
        td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; }
        
        /* MODAL */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 1000;
            display: none; justify-content: center; align-items: center;
        }
        .modal { background: var(--bg-panel); padding: 30px; border-radius: 15px; width: 400px; border: 1px solid var(--accent); }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h1 style="color:var(--accent)">K.S SERVIÇO</h1>
            <p style="color:#94a3b8; margin-bottom:20px;">Gestão de Segurança e Patrimônio</p>
            <button class="btn btn-gold" onclick="fazerLoginGoogle()">
                <i class="fab fa-google"></i> Entrar com Google
            </button>
        </div>
    </div>

    <div id="app-container">
        <aside>
            <div class="logo-area"><i class="fa-solid fa-shield-halved"></i> K.S SERVIÇO</div>
            <nav>
                <button onclick="nav('dashboard')" class="active"><i class="fa-solid fa-chart-line"></i> Dashboard & Lucro</button>
                <button onclick="nav('operacoes')"><i class="fa-solid fa-hand-holding-dollar"></i> Vendas e Aluguéis</button>
                <button onclick="nav('financeiro')"><i class="fa-solid fa-file-invoice-dollar"></i> Gastos (Caixa)</button>
                <button onclick="nav('estoque')"><i class="fa-solid fa-boxes-stacked"></i> Estoque e Compras</button>
                <button onclick="nav('relatorios')"><i class="fa-solid fa-print"></i> Relatórios PDF</button>
                <div style="margin-top:auto; padding:20px; font-size:0.8rem; color:#64748b;">
                    Usuario: <span id="user-display">--</span><br>
                    <a href="#" onclick="sair()" style="color:var(--danger)">Sair</a>
                </div>
            </nav>
        </aside>

        <main>
            <div id="view-dashboard" class="view">
                <div class="card-grid">
                    <div class="kpi-card">
                        <div style="color:var(--success)">Lucro Líquido Real</div>
                        <div class="kpi-value" id="kpi-lucro">R$ 0,00</div>
                        <small style="color:#94a3b8">Receitas - (Compras + Gastos)</small>
                    </div>
                    <div class="kpi-card">
                        <div style="color:var(--info)">Patrimônio Alugado</div>
                        <div class="kpi-value" id="kpi-patrimonio">R$ 0,00</div>
                        <small style="color:#94a3b8">Ativos gerando renda na rua</small>
                    </div>
                    <div class="kpi-card">
                        <div style="color:var(--danger)">Gastos Operacionais</div>
                        <div class="kpi-value" id="kpi-gastos">R$ 0,00</div>
                        <small style="color:#94a3b8">Combustível, Alimentação, etc.</small>
                    </div>
                </div>

                <div class="panel">
                    <h2><i class="fa-solid fa-location-dot"></i> Mapa de Ativos (Onde estão meus equipamentos?)</h2>
                    <table>
                        <thead><tr><th>Cliente</th><th>Equipamento</th><th>Desde</th><th>Status</th><th>Ação</th></tr></thead>
                        <tbody id="lista-ativos-dash"></tbody>
                    </table>
                </div>
            </div>

            <div id="view-operacoes" class="view" style="display:none">
                <div class="panel">
                    <h2>Nova Operação</h2>
                    <div class="form-row">
                        <div>
                            <label>Cliente</label>
                            <input type="text" id="op-cliente" placeholder="Nome / CPF / CNPJ">
                        </div>
                        <div>
                            <label>Tipo Operação</label>
                            <select id="op-tipo">
                                <option value="venda">Venda Direta</option>
                                <option value="aluguel">Aluguel Recorrente</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div>
                            <label>Equipamento (Estoque)</label>
                            <select id="op-equipamento"></select>
                        </div>
                        <div>
                            <label>Quantidade / Metros</label>
                            <input type="number" id="op-qtd" value="1">
                        </div>
                    </div>
                    <div class="form-row">
                        <div>
                            <label>Valor Mão de Obra / Instalação (R$)</label>
                            <input type="number" id="op-taxa" value="0">
                        </div>
                        <div>
                            <label>Data Cobrança / Instalação</label>
                            <input type="date" id="op-data">
                        </div>
                    </div>
                    <button class="btn btn-green" onclick="lancarOperacao()">CONFIRMAR E BAIXAR ESTOQUE</button>
                </div>
            </div>

            <div id="view-financeiro" class="view" style="display:none">
                <div class="panel">
                    <h2>Lançar Despesa Operacional (Não Estoque)</h2>
                    <p style="font-size:0.8rem; color:var(--text-muted)">Use para Combustível, Alimentação, Marketing, Ferramentas.</p>
                    <div class="form-row">
                        <input type="text" id="desp-desc" placeholder="Descrição (Ex: Gasolina Posto X)">
                        <input type="number" id="desp-valor" placeholder="Valor (R$)">
                        <input type="date" id="desp-data">
                        <button class="btn btn-red" onclick="lancarDespesa()">Registrar Saída</button>
                    </div>
                </div>
                <div class="panel">
                    <h2>Histórico de Gastos</h2>
                    <table id="tabela-gastos"></table>
                </div>
            </div>

            <div id="view-estoque" class="view" style="display:none">
                <div class="panel">
                    <h2>Cadastrar Nova Compra (Entrada de Estoque)</h2>
                    <div class="form-row">
                        <input type="text" id="est-nome" placeholder="Nome do Produto">
                        <select id="est-medida">
                            <option value="unidade">Unidade (Peça)</option>
                            <option value="metro">Metragem (Fios/Cabos)</option>
                        </select>
                        <select id="est-condicao">
                            <option value="novo">Novo</option>
                            <option value="usado">Usado/Recondicionado</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <input type="number" id="est-custo" placeholder="Preço de Custo (Unit/Metro)">
                        <input type="number" id="est-venda" placeholder="Preço Sugerido Venda">
                        <input type="number" id="est-aluguel" placeholder="Preço Sugerido Aluguel">
                        <input type="number" id="est-qtd" placeholder="Quantidade Inicial">
                    </div>
                    <button class="btn btn-gold" onclick="cadastrarEstoque()">Salvar no Estoque</button>
                </div>
                <div class="panel">
                    <h2>Estoque Atual</h2>
                    <table id="tabela-estoque"></table>
                </div>
            </div>

            <div id="view-relatorios" class="view" style="display:none">
                <div class="panel">
                    <h2>Relatórios Gerenciais</h2>
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button class="btn btn-gold" onclick="window.print()">Gerar PDF (Imprimir)</button>
                    </div>
                    <h3>Demonstrativo Financeiro (DRE Simples)</h3>
                    <table style="border:1px solid #333;">
                        <tr><td>(+) Total Vendas</td><td id="rel-vendas" style="color:var(--success)">R$ 0,00</td></tr>
                        <tr><td>(+) Total Serviços/Instalação</td><td id="rel-servicos" style="color:var(--success)">R$ 0,00</td></tr>
                        <tr><td>(+) Receita Aluguel (Acumulado)</td><td id="rel-alugueis" style="color:var(--info)">R$ 0,00</td></tr>
                        <tr><td>(-) Custo Mercadoria (Compras)</td><td id="rel-compras" style="color:var(--danger)">R$ 0,00</td></tr>
                        <tr><td>(-) Despesas Operacionais</td><td id="rel-despesas" style="color:var(--danger)">R$ 0,00</td></tr>
                        <tr style="background:var(--accent); color:black; font-weight:bold;">
                            <td>= LUCRO LÍQUIDO</td><td id="rel-liquido">R$ 0,00</td>
                        </tr>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <div id="modal-devolucao" class="modal-overlay">
        <div class="modal">
            <h2 style="color:var(--danger)">Encerrar Contrato / Devolução</h2>
            <p>Confirmação Crítica de Segurança</p>
            
            <label>Aplicar Multa por Quebra de Contrato? (R$)</label>
            <input type="number" id="dev-multa" value="0">
            
            <label style="margin-top:15px">Estado do Equipamento na Devolução:</label>
            <select id="dev-estado">
                <option value="usado">Volta como USADO (Reutilizável)</option>
                <option value="novo">Volta como NOVO (Sem uso)</option>
                <option value="lixo">Danificado (Descarte)</option>
            </select>

            <div style="display:flex; gap:10px; margin-top:20px;">
                <button class="btn" style="background:#333; color:white" onclick="fecharModal()">Cancelar</button>
                <button class="btn btn-red" onclick="confirmarDevolucao()">CONFIRMAR ENCERRAMENTO</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, increment, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBbs5adc-5M46SujfgPpOYOHTjsncxce_8",
            authDomain: "kelvin-c16b4.firebaseapp.com",
            databaseURL: "https://kelvin-c16b4-default-rtdb.firebaseio.com",
            projectId: "kelvin-c16b4",
            storageBucket: "kelvin-c16b4.firebasestorage.app",
            messagingSenderId: "388075706958",
            appId: "1:388075706958:web:b2c631e8690cea14acc11f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let idContratoSelecionado = null;
        let idProdutoSelecionado = null;
        let qtdSelecionada = 0;

        // --- NAVEGAÇÃO ---
        window.nav = (id) => {
            document.querySelectorAll('.view').forEach(el => el.style.display = 'none');
            document.getElementById('view-'+id).style.display = 'block';
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            event.currentTarget.classList.add('active');
        };

        // --- AUTH ---
        window.fazerLoginGoogle = () => {
            signInWithPopup(auth, new GoogleAuthProvider()).then(res => checkUser(res.user)).catch(e => alert(e.message));
        };
        window.sair = () => signOut(auth).then(() => location.reload());

        function checkUser(user) {
            const allowed = ['kelvinedu723@gmail.com', 'mar.junior.silva@gmail.com'];
            if(allowed.includes(user.email)) {
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('app-container').style.display = 'flex';
                document.getElementById('user-display').innerText = user.displayName;
                iniciarSistema();
            } else { alert("Acesso não autorizado."); signOut(auth); }
        }
        onAuthStateChanged(auth, u => { if(u) checkUser(u); });

        // --- LÓGICA DO SISTEMA ---
        function iniciarSistema() {
            let cacheEstoque = {};

            // 1. CARREGAR ESTOQUE (Selects e Tabelas)
            onSnapshot(collection(db, "estoque"), (snap) => {
                const sel = document.getElementById('op-equipamento');
                const tb = document.getElementById('tabela-estoque');
                sel.innerHTML = '<option value="">Selecione...</option>';
                tb.innerHTML = '<thead><tr><th>Nome</th><th>Condição</th><th>Custo</th><th>Venda</th><th>Aluguel</th><th>Qtd/Metros</th></tr></thead><tbody>';
                
                let custoTotalEstoque = 0;

                snap.forEach(d => {
                    const i = d.data();
                    cacheEstoque[d.id] = i;
                    custoTotalEstoque += (i.custo * i.qtd);

                    sel.innerHTML += `<option value="${d.id}">${i.nome} - ${i.condicao} (${i.qtd} ${i.medida})</option>`;
                    tb.innerHTML += `<tr><td>${i.nome}</td><td>${i.condicao}</td><td>R$ ${i.custo}</td><td>R$ ${i.venda}</td><td>R$ ${i.aluguel}</td><td>${i.qtd}</td></tr>`;
                });
                document.getElementById('rel-compras').innerText = `R$ ${custoTotalEstoque.toFixed(2)}`;
                calcularLucroGlobal();
            });

            // 2. CADASTRAR NOVO ITEM NO ESTOQUE (COMPRA)
            window.cadastrarEstoque = async () => {
                try {
                    await addDoc(collection(db, "estoque"), {
                        nome: document.getElementById('est-nome').value,
                        medida: document.getElementById('est-medida').value,
                        condicao: document.getElementById('est-condicao').value,
                        custo: Number(document.getElementById('est-custo').value),
                        venda: Number(document.getElementById('est-venda').value),
                        aluguel: Number(document.getElementById('est-aluguel').value),
                        qtd: Number(document.getElementById('est-qtd').value),
                        data_entrada: new Date().toISOString()
                    });
                    alert("Compra registrada e estoque atualizado!");
                    // Limpar campos...
                } catch(e) { alert("Erro: " + e.message); }
            };

            // 3. REGISTRAR DESPESA OPERACIONAL
            window.lancarDespesa = async () => {
                await addDoc(collection(db, "movimentacoes"), {
                    tipo: 'saida_operacional',
                    descricao: document.getElementById('desp-desc').value,
                    valor: Number(document.getElementById('desp-valor').value),
                    data: document.getElementById('desp-data').value,
                    timestamp: new Date()
                });
                alert("Despesa registrada!");
            };

            // 4. LANÇAR OPERAÇÃO (VENDA OU ALUGUEL)
            window.lancarOperacao = async () => {
                const idProd = document.getElementById('op-equipamento').value;
                const qtd = Number(document.getElementById('op-qtd').value);
                
                if(!idProd || qtd <= 0) return alert("Verifique o produto e a quantidade.");
                if(cacheEstoque[idProd].qtd < qtd) return alert("Estoque insuficiente!");

                const tipo = document.getElementById('op-tipo').value;
                const taxa = Number(document.getElementById('op-taxa').value);
                const prod = cacheEstoque[idProd];
                const valorOp = tipo === 'venda' ? prod.venda * qtd : prod.aluguel * qtd; // Se venda = valor total, Se aluguel = mensalidade

                // Salva o Contrato
                await addDoc(collection(db, "contratos"), {
                    cliente: document.getElementById('op-cliente').value,
                    tipo: tipo,
                    equipamentoId: idProd,
                    equipamentoNome: prod.nome,
                    qtd: qtd,
                    valorRecorrente: tipo === 'aluguel' ? valorOp : 0,
                    valorVendaTotal: tipo === 'venda' ? valorOp : 0,
                    taxaInstalacao: taxa,
                    dataCobranca: document.getElementById('op-data').value,
                    status: 'Ativo',
                    dataInicio: new Date().toISOString()
                });

                // Registra Entrada de Caixa (Instalação + Venda se houver)
                if(tipo === 'venda' || taxa > 0) {
                    await addDoc(collection(db, "movimentacoes"), {
                        tipo: 'entrada_venda_servico',
                        valor: (tipo === 'venda' ? valorOp : 0) + taxa,
                        descricao: `${tipo.toUpperCase()} - ${prod.nome} (${qtd})`
                    });
                }

                // Baixa Estoque
                await updateDoc(doc(db, "estoque", idProd), { qtd: increment(-qtd) });
                
                alert("Operação realizada com sucesso!");
            };

            // 5. MONITORAR CONTRATOS ATIVOS (DASHBOARD)
            onSnapshot(collection(db, "contratos"), (snap) => {
                const lista = document.getElementById('lista-ativos-dash');
                lista.innerHTML = '';
                let patrimonioAlugado = 0;
                let receitaAluguel = 0;
                let totalVendas = 0;
                let totalServicos = 0;

                snap.forEach(d => {
                    const c = d.data();
                    
                    if(c.tipo === 'venda') {
                        totalVendas += (c.valorVendaTotal || 0);
                    }
                    if(c.taxaInstalacao) totalServicos += c.taxaInstalacao;

                    if(c.status === 'Ativo' && c.tipo === 'aluguel') {
                        receitaAluguel += c.valorRecorrente;
                        // Estimativa de patrimônio na rua (usando custo do produto se possivel, ou valor venda)
                        // Simplificando para visualização
                        patrimonioAlugado += (c.valorRecorrente * 10); 
                        
                        lista.innerHTML += `
                            <tr>
                                <td>${c.cliente}</td>
                                <td>${c.equipamentoNome} (${c.qtd})</td>
                                <td>${new Date(c.dataInicio).toLocaleDateString()}</td>
                                <td><span class="badge" style="background:#dbeafe; color:#1e40af">ALUGADO</span></td>
                                <td><button class="btn btn-red" style="padding:5px 10px; font-size:0.7rem" 
                                    onclick="abrirModalDev('${d.id}', '${c.equipamentoId}', ${c.qtd})">Encerrar</button>
                                </td>
                            </tr>
                        `;
                    }
                });

                document.getElementById('kpi-patrimonio').innerText = `R$ ${patrimonioAlugado.toFixed(2)}`;
                document.getElementById('rel-vendas').innerText = `R$ ${totalVendas.toFixed(2)}`;
                document.getElementById('rel-servicos').innerText = `R$ ${totalServicos.toFixed(2)}`;
                document.getElementById('rel-alugueis').innerText = `R$ ${receitaAluguel.toFixed(2)} (Mês)`;
                calcularLucroGlobal();
            });

            // 6. MONITORAR GASTOS
            onSnapshot(collection(db, "movimentacoes"), (snap) => {
                const tb = document.getElementById('tabela-gastos');
                tb.innerHTML = '';
                let totalGastos = 0;

                snap.forEach(d => {
                    const m = d.data();
                    if(m.tipo === 'saida_operacional') {
                        totalGastos += m.valor;
                        tb.innerHTML += `<tr><td>${m.descricao}</td><td>${new Date(m.timestamp?.toDate()).toLocaleDateString()}</td><td style="color:red">- R$ ${m.valor}</td></tr>`;
                    }
                });
                document.getElementById('kpi-gastos').innerText = `R$ ${totalGastos.toFixed(2)}`;
                document.getElementById('rel-despesas').innerText = `R$ ${totalGastos.toFixed(2)}`;
                calcularLucroGlobal();
            });

            // MODAL FUNCTIONS
            window.abrirModalDev = (idContrato, idProd, qtd) => {
                idContratoSelecionado = idContrato;
                idProdutoSelecionado = idProd;
                qtdSelecionada = qtd;
                document.getElementById('modal-devolucao').style.display = 'flex';
            };

            window.fecharModal = () => document.getElementById('modal-devolucao').style.display = 'none';

            window.confirmarDevolucao = async () => {
                const multa = Number(document.getElementById('dev-multa').value);
                const estado = document.getElementById('dev-estado').value;

                // 1. Encerra Contrato
                await updateDoc(doc(db, "contratos", idContratoSelecionado), {
                    status: 'Encerrado',
                    dataFim: new Date().toISOString(),
                    multaAplicada: multa,
                    estadoDevolucao: estado
                });

                // 2. Registra Multa no Financeiro (Se houver)
                if(multa > 0) {
                    await addDoc(collection(db, "movimentacoes"), {
                        tipo: 'entrada_multa',
                        valor: multa,
                        descricao: 'Multa Rescisão Contrato'
                    });
                }

                // 3. Logística Reversa (Volta pro Estoque?)
                if(estado !== 'lixo') {
                    // Aqui o ideal seria verificar se já existe um item "Usado" desse modelo e somar, 
                    // mas para simplificar vamos devolver ao ID original e adicionar uma nota no log, 
                    // ou incrementa o estoque original.
                    await updateDoc(doc(db, "estoque", idProdutoSelecionado), { qtd: increment(qtdSelecionada) });
                }

                alert("Contrato Encerrado com Sucesso!");
                fecharModal();
            };

            function calcularLucroGlobal() {
                // Pega os valores de texto da tela, limpa o "R$" e calcula
                const pegarValor = (id) => parseFloat(document.getElementById(id).innerText.replace('R$', '').replace('(Mês)', '').trim()) || 0;
                
                const entradas = pegarValor('rel-vendas') + pegarValor('rel-servicos') + pegarValor('rel-alugueis'); // Aluguel aqui está simplificado mensal
                const saidas = pegarValor('rel-compras') + pegarValor('rel-despesas');
                
                const liquido = entradas - saidas;
                const el = document.getElementById('rel-liquido');
                const kpi = document.getElementById('kpi-lucro');
                
                const formatado = `R$ ${liquido.toFixed(2)}`;
                el.innerText = formatado;
                kpi.innerText = formatado;
                
                el.style.color = liquido >= 0 ? 'var(--success)' : 'var(--danger)';
            }
        }
    </script>
</body>
</html>
